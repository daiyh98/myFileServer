## 初始服务架构

![image](https://github.com/daiyh98/myFileServer/assets/43029102/d713ecab-7deb-46e4-83e5-c7266a4439b3)

### 用户与server之间的交互

1. 上传/下载
2. 查看/删除

### 接口列表

| 接口描述 | 接口url            |
| -------- | ------------------ |
| 文件上传 | POST /file/upload  |
| 文件下载 | GET /file/download |
| 文件查询 | GET /file/query    |
| 文件删除 | POST /file/update  |
|          |                    |

### 文件上传功能原理：

![go_server_structure_annotated_interface](https://github.com/daiyh98/myFileServer/assets/43029102/f52b0344-430b-4fe5-8ebe-0c0d9e3c5153)

1. 获取上传页面
2. 选取本地文件，以form形式上传文件
3. 云端接收文件流，写入本地存储
4. 云端更新文件元信息集合

### 文件元信息记录、更新与查询

首先创建了一个metaInfo包，包内部定义了一个`FileMeta`结构体，用来存储每个文件的元信息，包括：

- 文件哈希值
- 文件名
- 文件位置
- 更新时间
- 文件大小

然后为了存储所有元信息，采用`var`语句声明出一个map变量，key是文件哈希值，value是该文件的元信息结构体。在该包的`init()`函数中为map变量进行了`make`函数初始化，这样就不会发生对nil map进行更新而发生的panic。

在metaInfo包内还创建了对于元信息map变量进行增删改查的函数，这些函数在handler包中被具体的处理逻辑所调用，从而达到记录用户操作、存储文件基本信息的功能。

### 总结

在实现上述文件上传、记录文件元信息的接口功能之后，我们又陆续编写了查询某个文件的元信息、下载某个文件到用户端以及更新文件元信息、删除本地存储中的某个文件等接口。尤其是后面两个功能，使用了`POST`请求，这在浏览器中进行测试较为不方便，所以使用了postman作为辅助工具。

在上述过程中学会了以下知识点：

1. 使用`http.HandleFunc()`函数来注册特定请求url的处理函数，这个处理函数就是我们自己编写的一系列`Handler()`函数，这类函数往往需要传入两个参数，一个是`http.ResponsWriter`类型，另一个是`*http.request`类型。前者主要负责返回响应，例如请求的信息、处理完成的提示或状态码以及一些错误提示等，后者则记录了请求所包含的内容。
2. 巩固了`init()`函数`defer`关键字等知识点。
3. 学习了在网络传输中文件以及数据流的读写和其他操作。
4. sha1sum指令可以获得某一路径中文件的sha1哈希值。MacOS系统中没有这个指令，但是预置了替代指令`shasum`。使用方法是`shasum 文件路径`

